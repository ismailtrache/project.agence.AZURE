{% extends "base.html" %}
{% block content %}
<style>
    .hero { min-height: 70vh; color: white; display: flex; align-items: center; justify-content: center; text-align: center; position: relative; background: linear-gradient(rgba(0,0,0,0.45), rgba(0,0,0,0.7)), url("{% if 'http' in data.destinations[8].image %}{{ data.destinations[8].image }}{% else %}{{ url_for('static', filename=data.destinations[8].image) }}{% endif %}") no-repeat center center/cover; }
    .hero-content { z-index: 2; padding: 0 1rem; max-width: 880px; }
    .hero-kicker { text-transform: uppercase; letter-spacing: 0.2em; font-size: 0.8rem; color: rgba(255,255,255,0.75); margin-bottom: 0.75rem; }
    .hero h1 { font-size: 2.4rem; font-weight: 800; margin-bottom: 1rem; }
    .hero p { font-size: 1.05rem; margin-bottom: 0; color: rgba(255,255,255,0.9); }
    .hero-actions { display: flex; gap: 1rem; flex-wrap: wrap; justify-content: center; margin-top: 1.6rem; }
    .hero-proof { margin-top: 1rem; font-size: 0.9rem; color: rgba(255,255,255,0.75); }
    .btn { display: inline-flex; align-items: center; justify-content: center; gap: 0.5rem; padding: 0.85rem 1.6rem; border-radius: 999px; font-weight: 600; text-decoration: none; border: 2px solid transparent; transition: all 0.3s ease; }
    .btn-primary { background: var(--primary); color: #fff; box-shadow: 0 12px 25px rgba(44,91,97,0.35); }
    .btn-primary:hover { transform: translateY(-2px); box-shadow: 0 14px 30px rgba(44,91,97,0.45); }
    .btn-secondary { background: var(--primary); color: #fff; box-shadow: 0 12px 25px rgba(44,91,97,0.35); }
    .btn-secondary:hover { transform: translateY(-2px); box-shadow: 0 14px 30px rgba(44,91,97,0.45); }
    .services-grid, .destinations-grid, .why-us-grid { display: grid; gap: 1.5rem; grid-template-columns: repeat(auto-fit, minmax(260px, 1fr)); }
    @media (min-width: 768px) {
        .hero { min-height: 80vh; }
        .hero h1 { font-size: 3.2rem; }
        .hero p { font-size: 1.2rem; }
    }
    .destination-card { background: white; border-radius: var(--border-radius); overflow: hidden; box-shadow: 0 16px 40px rgba(0,0,0,0.12); transition: all 0.3s ease; position: relative; border: 1px solid rgba(0,0,0,0.06); }
    .destination-card:hover { transform: translateY(-10px); box-shadow: 0 20px 50px rgba(0,0,0,0.18); }
    .destination-card img { width: 100%; height: 320px; object-fit: cover; transition: transform 0.6s ease; }
    .destination-card:hover img { transform: scale(1.05); }
    .dest-overlay { position: absolute; top: 0; left: 0; width: 100%; height: 100%; background: linear-gradient(180deg, rgba(0,0,0,0.05) 0%, rgba(0,0,0,0.75) 70%); }
    .dest-content { position: absolute; bottom: 0; left: 0; padding: 1.5rem; color: white; width: 100%; }
    .dest-content h3 { font-size: 1.3rem; margin-bottom: 0.5rem; }
    .dest-content p { color: rgba(255,255,255,0.85); }
    .dest-price { position: absolute; top: 1rem; right: 1rem; background: var(--accent); color: var(--dark); padding: 0.5rem 0.85rem; border-radius: 14px; font-weight: 700; text-align: right; display: flex; flex-direction: column; gap: 0.1rem; }
    .dest-price-label { font-size: 0.6rem; letter-spacing: 0.08em; text-transform: uppercase; }
    .dest-price-value { font-size: 1.05rem; }
    .dest-meta { margin-top: 0.75rem; display: flex; gap: 0.5rem; flex-wrap: wrap; }
    .dest-pill { background: rgba(255,255,255,0.15); border: 1px solid rgba(255,255,255,0.2); padding: 0.3rem 0.65rem; border-radius: 999px; font-size: 0.75rem; display: inline-flex; align-items: center; gap: 0.35rem; }
    .service-card { background: white; padding: 2rem; border-radius: var(--border-radius); text-align: center; box-shadow: var(--shadow); transition: all 0.3s ease; }
    .service-card:hover { transform: translateY(-10px); }
    .service-icon { font-size: 3rem; color: var(--primary); margin-bottom: 1rem; }
    .service-card h3 { color: var(--primary); margin-bottom: 1rem; }
    .why-us-icon { font-size: 2.5rem; color: var(--accent); margin-bottom: 1rem; }
    .flight-search { background: linear-gradient(135deg, rgba(44,91,97,0.12), rgba(234,179,8,0.12)); padding: 2.5rem 0 3.5rem; }
    .flight-search-card { background: #fff; border-radius: var(--border-radius); padding: 2rem; box-shadow: var(--shadow); margin: 0 auto; max-width: 980px; }
    .flight-search-header { display: flex; flex-wrap: wrap; gap: 1rem; align-items: center; justify-content: space-between; margin-bottom: 1.5rem; }
    .flight-search-header h2 { color: var(--primary); font-size: 1.9rem; margin-bottom: 0.25rem; }
    .flight-search-header p { color: var(--text-secondary); margin: 0; }
    .flight-search-badge { background: rgba(44,91,97,0.12); color: var(--primary); padding: 0.4rem 0.9rem; border-radius: 999px; font-weight: 600; font-size: 0.85rem; display: inline-flex; align-items: center; gap: 0.4rem; }
    .flight-search-form { display: grid; grid-template-columns: repeat(auto-fit, minmax(170px, 1fr)); gap: 1rem; align-items: end; }
    .flight-field label { display: block; font-weight: 600; color: var(--primary); margin-bottom: 0.4rem; }
    .flight-field input { width: 100%; padding: 0.75rem 0.85rem; border: 1px solid #d9e1e6; border-radius: 10px; font-size: 0.95rem; }
    .flight-search-button { width: 100%; }
    .flight-search-note { margin-top: 1rem; color: var(--text-secondary); font-size: 0.9rem; }
    .flight-alert { margin-top: 1rem; padding: 0.9rem 1rem; border-radius: 12px; font-weight: 600; }
    .flight-alert-error { background: #fee2e2; color: #991b1b; }
    .flight-results { margin-top: 1.5rem; display: grid; gap: 1rem; grid-template-columns: repeat(auto-fit, minmax(240px, 1fr)); }
    .flight-card { background: #f8fafc; border-radius: 16px; padding: 1rem; border: 1px solid #e2e8f0; display: flex; flex-direction: column; gap: 0.9rem; }
    .flight-card-top { display: flex; align-items: flex-start; justify-content: space-between; gap: 1rem; }
    .flight-airline { font-weight: 700; color: var(--primary); }
    .flight-number { color: var(--text-secondary); font-size: 0.9rem; }
    .flight-status { padding: 0.3rem 0.6rem; border-radius: 999px; font-size: 0.75rem; font-weight: 700; text-transform: capitalize; }
    .flight-status-scheduled { background: #e2e8f0; color: #475569; }
    .flight-status-active { background: #dcfce7; color: #166534; }
    .flight-status-landed { background: #dbeafe; color: #1d4ed8; }
    .flight-status-cancelled { background: #fee2e2; color: #991b1b; }
    .flight-status-incident, .flight-status-diverted { background: #fef3c7; color: #92400e; }
    .flight-status-unknown { background: #e5e7eb; color: #374151; }
    .flight-route { display: grid; grid-template-columns: 1fr auto 1fr; align-items: center; gap: 0.75rem; }
    .flight-iata { font-size: 1.2rem; font-weight: 700; color: var(--primary); }
    .flight-airport { color: var(--text-secondary); font-size: 0.85rem; }
    .flight-time { margin-top: 0.35rem; font-weight: 600; }
    .flight-arrow { color: var(--accent); font-size: 1.1rem; text-align: center; }
    @media (max-width: 768px) {
        .hero { padding: 3.5rem 0 3rem; }
        .hero-content { max-width: 100%; }
        .hero-actions { flex-direction: column; }
        .btn { width: 100%; font-size: 1rem; }
        .flight-search { padding: 2rem 0 2.5rem; }
        .flight-search-card { padding: 1.5rem; }
        .flight-search-header { align-items: flex-start; }
    }
    @media (max-width: 576px) {
        .hero { min-height: 60vh; }
        .destination-card img { height: 240px; }
        .dest-content { padding: 1.1rem; }
    }
</style>

<section class="hero">
    <div class="hero-content">
        <div class="hero-kicker">Voyage sur mesure</div>
        <h1>Le voyage de vos reves commence ici</h1>
        <p>Des itineraires clairs, un suivi rapide, et des conseils pour voyager sans stress.</p>
        <div class="hero-actions">
            <a class="btn btn-primary" href="{{ url_for('contact') }}"><i class="fas fa-paper-plane"></i> Demander un devis</a>
            <a class="btn btn-secondary" href="https://wa.me/213658161112" target="_blank" rel="noopener"><i class="fab fa-whatsapp"></i> WhatsApp</a>
        </div>
        <div class="hero-proof">Reponse rapide + assistance 7j/7</div>
    </div>
</section>

<section class="section flight-search">
    <div class="container">
        <div class="flight-search-card">
            <div class="flight-search-header">
                <div>
                    <h2>Trouver un vol</h2>
                    <p>Horaires et statut des vols en temps reel.</p>
                </div>
                <div class="flight-search-badge"><i class="fas fa-plane"></i> Info vols</div>
            </div>
            <form class="flight-search-form" method="post" action="{{ url_for('flight_search') }}">
                <div class="flight-field">
                    <label for="departure">Depart (IATA)</label>
                    <input type="text" id="departure" name="departure" list="iata-list" maxlength="3" pattern="[A-Za-z]{3}" placeholder="CDG" value="{{ flight_query.get('dep_iata', '') }}" required>
                </div>
                <div class="flight-field">
                    <label for="arrival">Arrivee (IATA)</label>
                    <input type="text" id="arrival" name="arrival" list="iata-list" maxlength="3" pattern="[A-Za-z]{3}" placeholder="ALG" value="{{ flight_query.get('arr_iata', '') }}" required>
                </div>
                <div class="flight-field">
                    <label for="flight-date">Date</label>
                    <input type="date" id="flight-date" name="flight_date" value="{{ flight_query.get('flight_date', '') }}" required>
                </div>
                <button class="btn btn-primary flight-search-button" type="submit"><i class="fas fa-search"></i> Rechercher</button>
            </form>
            <datalist id="iata-list"></datalist>
            <p class="flight-search-note">Exemples: ALG, CDG, DXB, ORN. Les horaires sont fournis a titre indicatif.</p>
            {% if flight_error %}
            <div class="flight-alert flight-alert-error">{{ flight_error }}</div>
            {% endif %}
            {% if flight_results %}
            <div class="flight-results">
                {% for flight in flight_results %}
                <div class="flight-card">
                    <div class="flight-card-top">
                        <div>
                            <div class="flight-airline">{{ flight.airline }}</div>
                            <div class="flight-number">{{ flight.flight_number }}</div>
                        </div>
                        <span class="flight-status flight-status-{{ flight.status_class }}">{{ flight.status }}</span>
                    </div>
                    <div class="flight-route">
                        <div>
                            <div class="flight-iata">{{ flight.dep_iata }}</div>
                            <div class="flight-airport">{{ flight.dep_airport }}</div>
                            <div class="flight-time">{{ flight.dep_time }}</div>
                        </div>
                        <div class="flight-arrow"><i class="fas fa-arrow-right"></i></div>
                        <div>
                            <div class="flight-iata">{{ flight.arr_iata }}</div>
                            <div class="flight-airport">{{ flight.arr_airport }}</div>
                            <div class="flight-time">{{ flight.arr_time }}</div>
                        </div>
                    </div>
                </div>
                {% endfor %}
            </div>
            {% endif %}
        </div>
    </div>
</section>
<script>
    const iataList = document.getElementById('iata-list');
    const iataInputs = [
        document.getElementById('departure'),
        document.getElementById('arrival')
    ].filter(Boolean);
    let iataTimer = null;

    function renderIataOptions(items) {
        if (!iataList) {
            return;
        }
        iataList.innerHTML = items
            .map(item => `<option value="${item.iata}" label="${item.label}"></option>`)
            .join('');
    }

    function fetchIataSuggestions(query) {
        if (!iataList) {
            return;
        }
        if (query.length < 2) {
            renderIataOptions([]);
            return;
        }
        fetch(`/iata-suggest?q=${encodeURIComponent(query)}`)
            .then(response => response.json())
            .then(renderIataOptions)
            .catch(() => renderIataOptions([]));
    }

    iataInputs.forEach(input => {
        input.addEventListener('input', event => {
            const value = event.target.value.trim();
            window.clearTimeout(iataTimer);
            iataTimer = window.setTimeout(() => fetchIataSuggestions(value), 250);
        });
    });
</script>

<section class="section">
    <div class="container">
        <h2 class="section-title">Nos Services Exclusifs</h2>
        <p class="section-subtitle">Nous nous occupons de tout pour que votre seule preoccupation soit de profiter.</p>
        {% set featured_services = [data.services[0], data.services[1], data.services[4], data.services[5]] %}
        <div class="services-grid">
            {% for service in featured_services %}
            <a href="{% if loop.first %}{{ url_for('destinations') }}{% else %}{{ url_for('service_detail', service_name=service.nom) }}{% endif %}" style="text-decoration: none; color: inherit;">
                <div class="service-card">
                    <div class="service-icon"><i class="fas {{ service.icon }}"></i></div>
                    <h3>{{ service.nom }}</h3>
                    <p>{{ service.description }}</p>
                </div>
            </a>
            {% endfor %}
        </div>
    </div>
</section>

<section class="section section-light">
    <div class="container">
        <h2 class="section-title">Destinations Populaires</h2>
        <p class="section-subtitle">Laissez-vous inspirer par notre selection des destinations les plus prisees du moment.</p>
        <div class="destinations-grid">
            {% for destination in data.destinations[:3] %}
            <a href="{{ url_for('contact') }}" class="destination-card quote-link" style="text-decoration: none; color: inherit;">
                <img src="{% if 'http' in destination.image %}{{ destination.image }}{% else %}{{ url_for('static', filename=destination.image) }}{% endif %}" alt="{{ destination.nom }}">
                <div class="dest-overlay"></div>
                <div class="dest-price">
                    <span class="dest-price-label">A partir de</span>
                    <span class="dest-price-value">{{ destination.prix }}</span>
                </div>
                <div class="dest-content">
                    <h3>{{ destination.nom }}</h3>
                    <p>{{ destination.description }}</p>
                    <div class="dest-meta">
                        <span class="dest-pill"><i class="fas fa-plane-departure"></i> Vol</span>
                        <span class="dest-pill"><i class="fas fa-hotel"></i> Hotel</span>
                        <span class="dest-pill"><i class="fas fa-headset"></i> Support</span>
                    </div>
                </div>
            </a>
            {% endfor %}
        </div>
    </div>
</section>

<section class="section">
    <div class="container">
        <h2 class="section-title">Pourquoi Nous Choisir ?</h2>
        <div class="why-us-grid">
            {% for item in data.why_us %}
            <div class="why-us-card">
                <div class="why-us-icon"><i class="fas {{ item.icon }}"></i></div>
                <h3>{{ item.title }}</h3>
                <p>{0{ item.description }}</p>
            </div>
            {% endfor %}
        </div>
    </div>
</section>
{% endblock %}
